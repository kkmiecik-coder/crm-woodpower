<!-- app/modules/dashboard/templates/dashboard.html - Modyfikacja istniejÄ…cego pliku -->

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Wood Power CRM</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('dashboard.static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar â€“ systemowy -->
        {% include 'sidebar/sidebar.html' %}

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="dashboard-header">
                <div class="header-top">
                    <h1 class="page-title title-with-underline">Dashboard</h1>
                    <!-- Quick Actions Bar -->
                    <div class="quick-actions-bar">
                        <div class="quick-actions-list">
                            <a href="/calculator/" class="quick-action-btn">
                                <span class="quick-action-icon">ðŸ§®</span>
                                Nowa Wycena
                            </a>
                            <a href="/clients" class="quick-action-btn">
                                <span class="quick-action-icon">ðŸ‘¥</span>
                                Dodaj Klienta
                            </a>
                            <a href="/quotes" class="quick-action-btn">
                                <span class="quick-action-icon">ðŸ“„</span>
                                Wszystkie Wyceny
                            </a>
                            <a href="/reports" class="quick-action-btn">
                                <span class="quick-action-icon">ðŸ“ˆ</span>
                                Raporty
                            </a>
                        </div>
                    </div>
                    <div class="user-greeting" id="user-greeting">
                        <div class="avatar-container">
                            <div class="user-avatar" style="background-image: url('{{ user_avatar }}');"></div>
                        </div>
                        <div class="greeting-text">
                            {% if user and (user.first_name or user.last_name) %}
                            Witaj, {{ user.first_name }} {{ user.last_name }}! ðŸ‘‹
                            {% else %}
                            Witaj, {{ user_name }}! ðŸ‘‹
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">

                <!-- Stats Overview -->
                {% include 'widgets/stats_widget.html' %}

                <!-- Weather Widget -->
                {% include 'widgets/weather_widget.html' %}

                <!-- NOWY: Active Users Widget (tylko dla adminÃ³w) -->
                {% include 'widgets/active_users_widget.html' %}

                <!-- Changelog Widget -->
                {% include 'widgets/changelog_widget.html' %}

                <!-- Quotes Chart -->
                {% include 'widgets/quotes_chart_widget.html' %}

                <!-- Recent Activity -->
                {% include 'widgets/recent_activity_widget.html' %}

                <!-- Top Products -->
                {% include 'widgets/top_products_widget.html' %}

            </div>
        </main>
    </div>

    <!-- Skrypty -->
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- DODAJ: Skrypt Active Users Widget -->
    {% if user and user.role == 'admin' %}
    <script src="{{ url_for('dashboard.static', filename='js/active_users.js') }}"></script>
    {% endif %}

    <script>
        // Przekazujemy dane z backendu do JavaScript
        window.dashboardStats = {{ stats|tojson }};
        window.weatherData = {{ weather|tojson }};
        console.log('[Dashboard] Stats:', window.dashboardStats);
        console.log('[Dashboard] Weather:', window.weatherData);
    </script>
    <script>
        // DEBUG: Przekazywanie danych z backendu do JS
        console.log('[Dashboard] DEBUG: Template variables loaded:');
        console.log('- stats:', {{ stats|tojson }});
        console.log('- chart_data:', {{ chart_data|tojson }});
        console.log('- weather:', {{ weather|tojson }});

        // Przechowuj dane globalnie dla debugowania
        window.chartData = {{ chart_data|tojson }};
        window.dashboardStats = {{ stats|tojson }};
        window.weatherData = {{ weather|tojson }};

        console.log('[Dashboard] DEBUG: Global variables set:', {
            chartData: !!window.chartData,
            dashboardStats: !!window.dashboardStats,
            weatherData: !!window.weatherData
        });

        // DODAJ: Debug info dla Active Users (tylko dla adminÃ³w)
        {% if user and user.role == 'admin' %}
        console.log('[Dashboard] Active Users Widget enabled for admin user');
        {% endif %}
    </script>
    <script src="{{ url_for('dashboard.static', filename='js/dashboard.js') }}"></script>
</body>
</html>