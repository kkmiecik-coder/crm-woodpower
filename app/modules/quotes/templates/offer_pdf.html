<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Oferta {{ quote.quote_number }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            font-size: 11px;
            line-height: 1.3;
            color: #333;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 2px solid #ed6b24;
            padding-bottom: 15px;
        }

        .logo-section {
            flex: 1;
        }

        .logo {
            width: 60px;
            height: 60px;
            background-color: #ed6b24;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        .logo-text {
            color: white;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            line-height: 1.1;
        }

        .company-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .offer-info {
            text-align: right;
            flex: 1;
        }

        .offer-title {
            font-size: 24px;
            font-weight: bold;
            color: #ed6b24;
            margin-bottom: 8px;
        }

        .offer-number {
            font-size: 16px;
            font-weight: bold;
            border: 2px solid #ed6b24;
            padding: 8px 15px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .offer-status {
            background-color: #f5f5f5;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 10px;
            text-transform: uppercase;
            font-weight: bold;
        }

        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            padding: 2px 0;
        }

        .detail-label {
            font-weight: normal;
            color: #666;
        }

        .detail-value {
            font-weight: bold;
            color: #333;
        }

        .parties-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        .party-box {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 6px;
            background-color: #fafafa;
        }

        .party-title {
            font-size: 14px;
            font-weight: bold;
            color: #ed6b24;
            margin-bottom: 10px;
            text-transform: uppercase;
            border-bottom: 1px solid #ed6b24;
            padding-bottom: 5px;
        }

        .party-info {
            line-height: 1.4;
        }

            .party-info strong {
                display: block;
                font-size: 13px;
                margin-bottom: 3px;
            }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }

            .items-table th {
                background-color: #ed6b24;
                color: white;
                padding: 8px 6px;
                text-align: center;
                font-weight: bold;
                font-size: 10px;
                border: 1px solid #d85d20;
            }

            .items-table td {
                padding: 8px 6px;
                text-align: center;
                border: 1px solid #ddd;
                font-size: 10px;
            }

            .items-table .item-name {
                text-align: left;
                max-width: 200px;
            }

            .items-table .number-cell {
                text-align: right;
                font-family: monospace;
            }

            .items-table tbody tr:nth-child(even) {
                background-color: #f9f9f9;
            }

        .summary-section {
            margin-top: 20px;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
        }

            .summary-table td {
                padding: 6px 10px;
                border: 1px solid #ddd;
            }

            .summary-table .label-cell {
                background-color: #f5f5f5;
                font-weight: bold;
                text-align: right;
                width: 70%;
            }

            .summary-table .value-cell {
                text-align: right;
                font-family: monospace;
                font-weight: bold;
            }

            .summary-table .total-row {
                background-color: #ed6b24;
                color: white;
                font-weight: bold;
                font-size: 12px;
            }

        .total-in-words {
            margin: 15px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-left: 4px solid #ed6b24;
            font-style: italic;
        }

        .notes-section {
            margin-top: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }

        .notes-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #ed6b24;
        }

        .signature-section {
            margin-top: 40px;
            text-align: center;
        }

        .signature-box {
            width: 300px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .signature-line {
            border-top: 1px solid #333;
            margin: 30px 0 10px 0;
        }

        .signature-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
        }

        .signature-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .signature-title {
            font-size: 9px;
            color: #666;
        }

        /* Ukryj sekcję podpisu klienta */
        .client-signature {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header z logo i podstawowymi informacjami -->
    <div class="header">
        <div class="logo-section">
            <div class="logo">
                <div class="logo-text">
                    WOOD<br>POWER
                </div>
            </div>
            <div class="company-name">woodpower</div>
        </div>

        <div class="offer-info">
            <div class="offer-title">Oferta handlowa</div>
            <div class="offer-number">{{ quote.quote_number }}</div>
            <div class="offer-status">
                {% if quote.quote_status %}
                {{ quote.quote_status.name }}
                {% else %}
                Oryginał
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Szczegóły oferty -->
    <div class="details-grid">
        <div class="left-details">
            <div class="detail-row">
                <span class="detail-label">Data wystawienia:</span>
                <span class="detail-value">{{ quote.created_at.strftime('%d.%m.%Y') if quote.created_at else '-' }}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Miejsce wystawienia:</span>
                <span class="detail-value">Bachórz</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Ważność oferty:</span>
                <span class="detail-value">30 dni</span>
            </div>
        </div>

        <div class="right-details">
            <div class="detail-row">
                <span class="detail-label">Sposób płatności:</span>
                <span class="detail-value">Przelew</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Źródło zapytania:</span>
                <span class="detail-value">{{ quote.source or '-' }}</span>
            </div>
            {% if quote.courier_name %}
            <div class="detail-row">
                <span class="detail-label">Kurier:</span>
                <span class="detail-value">{{ quote.courier_name }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Dane stron -->
    <div class="parties-section">
        <div class="party-box">
            <div class="party-title">Oferent:</div>
            <div class="party-info">
                <strong>Wood Power Sp. z o.o.</strong>
                Bachórz 14N,<br>
                36-068 Bachórz<br>
                <strong>NIP:</strong> PL8133787635<br><br>
                <strong>Dane do przelewu:</strong><br>
                Santander Bank Polska S.A<br>
                28 1090 2590 0000 0001 3689 2780
            </div>
        </div>

        <div class="party-box">
            <div class="party-title">Klient:</div>
            <div class="party-info">
                {% if quote.client %}
                <strong>{{ quote.client.client_name or quote.client.client_number or '-' }}</strong>
                {% if quote.client.delivery_address %}
                {{ quote.client.delivery_address }}<br>
                {% endif %}
                {% if quote.client.delivery_zip and quote.client.delivery_city %}
                {{ quote.client.delivery_zip }} {{ quote.client.delivery_city }}<br>
                {% endif %}
                {% if quote.client.email %}
                <strong>Email:</strong> {{ quote.client.email }}<br>
                {% endif %}
                {% if quote.client.phone %}
                <strong>Telefon:</strong> {{ quote.client.phone }}<br>
                {% endif %}
                {% else %}
                <em>Brak danych klienta</em>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tabela pozycji -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 8%">Lp.</th>
                <th style="width: 35%">Nazwa towaru/usługi</th>
                <th style="width: 8%">JM</th>
                <th style="width: 12%">Jedn. netto</th>
                <th style="width: 12%">Jedn. brutto</th>
                <th style="width: 8%">Ilość</th>
                <th style="width: 17%">Wartość brutto</th>
            </tr>
        </thead>
        <tbody>
            {% set selected_items = quote.items | selectattr('is_selected') | list %}
            {% for item in selected_items %}
            {% set loop_index = loop.index %}
            {% set variant_name = {
            'dab-lity-ab': 'Dąb lity A/B',
            'dab-lity-bb': 'Dąb lity B/B',
            'dab-micro-ab': 'Dąb mikrowczep A/B',
            'dab-micro-bb': 'Dąb mikrowczep B/B',
            'jes-lity-ab': 'Jesion lity A/B',
            'jes-micro-ab': 'Jesion mikrowczep A/B',
            'buk-lity-ab': 'Buk lity A/B',
            'buk-micro-ab': 'Buk mikrowczep A/B'
            }.get(item.variant_code, item.variant_code) %}

            <tr>
                <td>{{ loop_index }}</td>
                <td class="item-name">
                    Blat drewniany {{ variant_name }}<br>
                    <small>{{ item.length_cm }}×{{ item.width_cm }}×{{ item.thickness_cm }} cm</small>
                    {% if item.volume_m3 %}
                    <br><small>Objętość: {{ "%.3f"|format(item.volume_m3) }} m³</small>
                    {% endif %}
                </td>
                <td>szt</td>
                <td class="number-cell">{{ "%.2f"|format(item.final_price_netto or 0) }}</td>
                <td class="number-cell">{{ "%.2f"|format(item.final_price_brutto or 0) }}</td>
                <td>1</td>
                <td class="number-cell">{{ "%.2f"|format(item.final_price_brutto or 0) }}</td>
            </tr>

            <!-- Wykończenie dla tego produktu -->
            {% for finishing in quote.finishing if finishing.product_index == item.product_index %}
            {% if finishing.finishing_price_brutto and finishing.finishing_price_brutto > 0 %}
            <tr>
                <td>{{ loop_index }}.1</td>
                <td class="item-name">
                    Wykończenie: {{ finishing.finishing_variant or '' }} {{ finishing.finishing_type or '' }}
                    {% if finishing.finishing_color %} - {{ finishing.finishing_color }}{% endif %}
                    {% if finishing.finishing_gloss_level %} ({{ finishing.finishing_gloss_level }}){% endif %}
                </td>
                <td>szt</td>
                <td class="number-cell">{{ "%.2f"|format(finishing.finishing_price_netto or 0) }}</td>
                <td class="number-cell">{{ "%.2f"|format(finishing.finishing_price_brutto or 0) }}</td>
                <td>1</td>
                <td class="number-cell">{{ "%.2f"|format(finishing.finishing_price_brutto or 0) }}</td>
            </tr>
            {% endif %}
            {% endfor %}
            {% endfor %}

            <!-- Wysyłka -->
            {% if quote.shipping_cost_brutto and quote.shipping_cost_brutto > 0 %}
            <tr>
                <td>{{ selected_items|length + 1 }}</td>
                <td class="item-name">
                    Dostawa kurierem{% if quote.courier_name %} - {{ quote.courier_name }}{% endif %}
                </td>
                <td>szt</td>
                <td class="number-cell">{{ "%.2f"|format(quote.shipping_cost_netto or 0) }}</td>
                <td class="number-cell">{{ "%.2f"|format(quote.shipping_cost_brutto or 0) }}</td>
                <td>1</td>
                <td class="number-cell">{{ "%.2f"|format(quote.shipping_cost_brutto or 0) }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    <!-- Podsumowanie -->
    <div class="summary-section">
        <table class="summary-table">
            {% if quote.costs %}
            <tr>
                <td class="label-cell">Razem netto:</td>
                <td class="value-cell">{{ "%.2f"|format(quote.costs.total.netto) }} PLN</td>
            </tr>
            <tr>
                <td class="label-cell">VAT 23%:</td>
                <td class="value-cell">{{ "%.2f"|format(quote.costs.total.brutto - quote.costs.total.netto) }} PLN</td>
            </tr>
            <tr class="total-row">
                <td class="label-cell">RAZEM BRUTTO:</td>
                <td class="value-cell">{{ "%.2f"|format(quote.costs.total.brutto) }} PLN</td>
            </tr>
            {% else %}
            <tr class="total-row">
                <td class="label-cell">RAZEM BRUTTO:</td>
                <td class="value-cell">{{ "%.2f"|format(quote.total_price or 0) }} PLN</td>
            </tr>
            {% endif %}
        </table>

        <div class="total-in-words">
            <strong>Słownie:</strong>
            {% set total_amount = quote.costs.total.brutto if quote.costs else (quote.total_price or 0) %}
            <!-- Tu można dodać konwersję liczby na słowa -->
            {{ "%.2f"|format(total_amount) }} PLN
        </div>
    </div>

    <!-- Uwagi -->
    {% if quote.client_comments or quote.seller_notes %}
    <div class="notes-section">
        <div class="notes-title">Uwagi:</div>
        {% if quote.seller_notes %}
        <div>{{ quote.seller_notes | replace('\n', '<br>') | safe }}</div>
        {% endif %}
        {% if quote.client_comments %}
        <div><strong>Komentarze klienta:</strong> {{ quote.client_comments | replace('\n', '<br>') | safe }}</div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Podpis tylko osoby wystawiającej -->
    <div class="signature-section">
        <div class="signature-box">
            <div class="signature-label">Osoba upoważniona do wystawienia oferty</div>
            <div class="signature-line"></div>
            {% if quote.user %}
            <div class="signature-name">{{ quote.user.first_name }} {{ quote.user.last_name }}</div>
            <div class="signature-title">Wood Power Sp. z o.o.</div>
            {% else %}
            <div class="signature-name">Wood Power Sp. z o.o.</div>
            {% endif %}
        </div>
    </div>
</body>
</html>