<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Statystyki - Wood Power CRM</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('analytics.static', filename='css/analytics.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <div class="app-container">
        {% include 'sidebar/sidebar.html' %}
        <main class="main-content">
            <h1 class="title-with-underline">Statystyki</h1>

            <!-- System tab√≥w - SPRZEDA≈ª PIERWSZA I AKTYWNA -->
            <div class="tabs">
                <div class="tab active" data-tab="sales-analytics">üí∞ Sprzeda≈º</div>
                <div class="tab" data-tab="team-analytics">üë• Zesp√≥≈Ç</div>
                <div class="tab" data-tab="clients-analytics">üë§ Klienci</div>
                <div class="tab" data-tab="baselinker-analytics">üîó Baselinker</div>
                <div class="tab" data-tab="public-calc">üìä Kalkulator publiczny</div>
            </div>

            <!-- ========================================= -->
            <!-- ZAK≈ÅADKA 1: SPRZEDA≈ª - AKTYWNA -->
            <!-- ========================================= -->
            <div id="sales-analytics" class="tab-content active">
                <div class="analytics-export-header">
                    <h2>Analityka sprzeda≈ºy</h2>
                    <div class="export-buttons">
                        <button class="export-btn" data-type="sales" data-format="xlsx">
                            üìä Export XLSX
                        </button>
                        <button class="export-btn" data-type="sales" data-format="csv">
                            üìã Export CSV
                        </button>
                    </div>
                </div>

                <!-- KPI Cards -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>KPI Sprzeda≈ºowe</h2>
                    </div>
                    <div class="analytics-stat-card-group">
                        <div class="analytics-stat-card sales-kpi">
                            <h3>üí∞ Miesiƒôczna warto≈õƒá</h3>
                            <p id="sales-monthly-value">{{ sales_kpi.monthly_value if sales_kpi else 0 }} PLN</p>
                        </div>
                        <div class="analytics-stat-card sales-kpi">
                            <h3>üìà Konwersja Accepted</h3>
                            <p id="sales-conversion-accepted">{{ sales_kpi.conversion_accepted if sales_kpi else 0 }}%</p>
                        </div>
                        <div class="analytics-stat-card sales-kpi">
                            <h3>üîó Konwersja Baselinker</h3>
                            <p id="sales-conversion-baselinker">{{ sales_kpi.conversion_baselinker if sales_kpi else 0 }}%</p>
                        </div>
                        <div class="analytics-stat-card sales-kpi">
                            <h3>üíé ≈örednia warto≈õƒá oferty</h3>
                            <p id="sales-avg-deal">{{ sales_kpi.avg_deal_value if sales_kpi else 0 }} PLN</p>
                        </div>
                    </div>
                </div>

                <!-- Trendy sprzeda≈ºy -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Trendy sprzeda≈ºy (ostatnie 12 miesiƒôcy)</h2>
                        <div class="chart-controls">
                            <select id="sales-months-select" class="chart-select">
                                <option value="6">6 miesiƒôcy</option>
                                <option value="12" selected>12 miesiƒôcy</option>
                                <option value="24">24 miesiƒÖce</option>
                            </select>
                        </div>
                    </div>
                    <div class="analytics-box-content">
                        <canvas id="salesTrendChart" width="800" height="300"></canvas>
                    </div>
                </div>

                <!-- Popularne produkty -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Najpopularniejsze produkty</h2>
                    </div>
                    <div class="analytics-box-content">
                        <div class="products-table-container">
                            <table id="popular-products-table" class="analytics-table">
                                <thead>
                                    <tr>
                                        <th>Kod wariantu</th>
                                        <th>Liczba u≈ºyƒá</th>
                                        <th>≈ör. cena/m¬≥</th>
                                        <th>≈ÅƒÖczna objƒôto≈õƒá</th>
                                        <th>≈ör. wymiary</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dane za≈Çadowane przez JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================= -->
            <!-- ZAK≈ÅADKA 2: ZESP√ì≈Å -->
            <!-- ========================================= -->
            <div id="team-analytics" class="tab-content">
                <div class="analytics-export-header">
                    <h2>Performance zespo≈Çu</h2>
                    <div class="export-buttons">
                        <button class="export-btn" data-type="team" data-format="xlsx">
                            üìä Export XLSX
                        </button>
                        <button class="export-btn" data-type="team" data-format="csv">
                            üìã Export CSV
                        </button>
                    </div>
                </div>

                <!-- Tabela zespo≈Çu -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Statystyki u≈ºytkownik√≥w</h2>
                        <div class="team-summary">
                            <span id="team-count">{{ team_count if team_count else 0 }} cz≈Çonk√≥w zespo≈Çu</span>
                        </div>
                    </div>
                    <div class="analytics-box-content">
                        <div class="team-table-container">
                            <table id="team-performance-table" class="analytics-table">
                                <thead>
                                    <tr>
                                        <th>U≈ºytkownik</th>
                                        <th>Liczba ofert</th>
                                        <th>Warto≈õƒá ≈ÇƒÖczna</th>
                                        <th>≈örednia warto≈õƒá</th>
                                        <th>Conv. Accepted</th>
                                        <th>Conv. Baselinker</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dane za≈Çadowane przez JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Wykresy por√≥wnawcze zespo≈Çu -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Por√≥wnanie performance</h2>
                        <div class="analytics-sub-tabs">
                            <button class="analytics-sub-tab active" data-target="teamQuotesChart">Liczba ofert</button>
                            <button class="analytics-sub-tab" data-target="teamValueChart">Warto≈õƒá</button>
                            <button class="analytics-sub-tab" data-target="teamConversionChart">Konwersja</button>
                        </div>
                    </div>
                    <div class="analytics-box-content">
                        <canvas id="teamQuotesChart" class="analytics-sub-chart visible" width="600" height="250"></canvas>
                        <canvas id="teamValueChart" class="analytics-sub-chart" width="600" height="250"></canvas>
                        <canvas id="teamConversionChart" class="analytics-sub-chart" width="600" height="250"></canvas>
                    </div>
                </div>
            </div>

            <!-- ========================================= -->
            <!-- ZAK≈ÅADKA 3: KLIENCI -->
            <!-- ========================================= -->
            <div id="clients-analytics" class="tab-content">
                <div class="analytics-export-header">
                    <h2>Analityka klient√≥w</h2>
                    <div class="export-buttons">
                        <button class="export-btn" data-type="clients" data-format="xlsx">
                            üìä Export XLSX
                        </button>
                        <button class="export-btn" data-type="clients" data-format="csv">
                            üìã Export CSV
                        </button>
                    </div>
                </div>

                <!-- Top klienci -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Top klienci wed≈Çug warto≈õci</h2>
                        <div class="chart-controls">
                            <select id="clients-limit-select" class="chart-select">
                                <option value="10">Top 10</option>
                                <option value="20" selected>Top 20</option>
                                <option value="50">Top 50</option>
                            </select>
                        </div>
                    </div>
                    <div class="analytics-box-content">
                        <div class="clients-table-container">
                            <table id="top-clients-table" class="analytics-table">
                                <thead>
                                    <tr>
                                        <th>Klient</th>
                                        <th>Miasto</th>
                                        <th>≈πr√≥d≈Ço</th>
                                        <th>Liczba ofert</th>
                                        <th>Warto≈õƒá ≈ÇƒÖczna</th>
                                        <th>Conv. Accepted</th>
                                        <th>Conv. Baselinker</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dane za≈Çadowane przez JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Geografia -->
                <div class="analytics-grid-2">
                    <div class="analytics-box">
                        <div class="analytics-box-header">
                            <h2>Mapa klient√≥w</h2>
                        </div>
                        <div class="analytics-box-content">
                            <div id="poland-map" style="height: 400px; width: 100%;"></div>
                        </div>
                    </div>

                    <div class="analytics-box">
                        <div class="analytics-box-header">
                            <h2>Top miasta</h2>
                        </div>
                        <div class="analytics-box-content">
                            <canvas id="citiesChart" width="400" height="250"></canvas>
                        </div>
                    </div>
                </div>

                <div class="analytics-grid-2">
                    <div class="analytics-box">
                        <div class="analytics-box-header">
                            <h2>≈πr√≥d≈Ça klient√≥w</h2>
                        </div>
                        <div class="analytics-box-content">
                            <canvas id="sourcesChart" width="400" height="250"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================= -->
            <!-- ZAK≈ÅADKA 4: BASELINKER -->
            <!-- ========================================= -->
            <div id="baselinker-analytics" class="tab-content">
                <div class="analytics-export-header">
                    <h2>Analityka Baselinker</h2>
                    <div class="export-buttons">
                        <button class="export-btn" data-type="baselinker" data-format="xlsx">
                            üìä Export XLSX
                        </button>
                        <button class="export-btn" data-type="baselinker" data-format="csv">
                            üìã Export CSV
                        </button>
                    </div>
                </div>

                <!-- KPI Baselinker -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>KPI Baselinker</h2>
                    </div>
                    <div class="analytics-stat-card-group">
                        <div class="analytics-stat-card baselinker-kpi">
                            <h3>üì¶ Zam√≥wienia ≈ÇƒÖcznie</h3>
                            <p id="baselinker-total-orders">-</p>
                        </div>
                        <div class="analytics-stat-card baselinker-kpi">
                            <h3>üìä Wska≈∫nik konwersji</h3>
                            <p id="baselinker-conversion-rate">{{ baselinker_conversion if baselinker_conversion else 0 }}%</p>
                        </div>
                        <div class="analytics-stat-card baselinker-kpi">
                            <h3>‚úÖ Wska≈∫nik sukcesu (30 dni)</h3>
                            <p id="baselinker-success-rate">-</p>
                        </div>
                        <div class="analytics-stat-card baselinker-kpi">
                            <h3>‚ö†Ô∏è B≈Çƒôdy (30 dni)</h3>
                            <p id="baselinker-errors">-</p>
                        </div>
                    </div>
                </div>

                <!-- Konwersja wed≈Çug status√≥w -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Konwersja wed≈Çug status√≥w ofert</h2>
                    </div>
                    <div class="analytics-box-content">
                        <canvas id="statusConversionChart" width="600" height="300"></canvas>
                    </div>
                </div>

                <!-- Ostatnie logi -->
                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Ostatnie akcje Baselinker</h2>
                    </div>
                    <div class="analytics-box-content">
                        <div class="baselinker-logs-container">
                            <table id="baselinker-logs-table" class="analytics-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Oferta</th>
                                        <th>Akcja</th>
                                        <th>Status</th>
                                        <th>B≈ÇƒÖd</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dane za≈Çadowane przez JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================= -->
            <!-- ZAK≈ÅADKA 5: KALKULATOR PUBLICZNY - OSTATNIA -->
            <!-- ========================================= -->
            <div id="public-calc" class="tab-content">
                <div class="analytics-export-header">
                    <h2>Statystyki kalkulatora publicznego</h2>
                    <div class="export-buttons">
                        <button class="export-btn" data-type="public_calc" data-format="xlsx">
                            üìä Export XLSX
                        </button>
                        <button class="export-btn" data-type="public_calc" data-format="csv">
                            üìã Export CSV
                        </button>
                    </div>
                </div>

                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Podsumowanie sesji</h2>
                    </div>
                    <div class="analytics-stat-card-group">
                        <div class="analytics-stat-card">
                            <h3>üî¢ Liczba sesji</h3>
                            <p>{{ total_sessions }}</p>
                        </div>
                        <div class="analytics-stat-card">
                            <h3>‚è± ≈öredni czas sesji</h3>
                            <p>{{ avg_duration_sec }} sek.</p>
                        </div>
                        <div class="analytics-stat-card">
                            <h3>üß† Sesje z wyborem koloru</h3>
                            <p>{{ color_sessions }}</p>
                        </div>
                        <div class="analytics-stat-card">
                            <h3>üéØ Sesje z wariantem</h3>
                            <p>{{ variant_sessions }}</p>
                        </div>
                    </div>
                </div>

                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Warianty i wyko≈Ñczenia</h2>
                        <div class="analytics-sub-tabs">
                            <button class="analytics-sub-tab active" data-target="variantChart">Warianty</button>
                            <button class="analytics-sub-tab" data-target="finishingChart">Wyko≈Ñczenia</button>
                        </div>
                    </div>
                    <div class="analytics-box-content">
                        <canvas id="variantChart" class="analytics-sub-chart visible" width="300" height="150"></canvas>
                        <canvas id="finishingChart" class="analytics-sub-chart" width="300" height="150"></canvas>
                    </div>
                </div>

                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Wymiary</h2>
                    </div>
                    <div class="analytics-box-content">
                        <canvas id="dimensionChart" width="300" height="150"></canvas>
                    </div>
                </div>

                <div class="analytics-box">
                    <div class="analytics-box-header">
                        <h2>Najczƒô≈õciej wybierane kolory</h2>
                    </div>
                    <div class="analytics-box-content">
                        <canvas id="colorChart" width="300" height="150"></canvas>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Loading overlay -->
    <div id="analytics-loading" class="analytics-loading hidden">
        <div class="loading-spinner"></div>
        <p>≈Åadowanie danych...</p>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{{ url_for('analytics.static', filename='js/product_translator.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/public_analytics.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/sales_analytics.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/team_analytics.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/clients_analytics.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/baselinker_analytics.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/export_utils.js') }}"></script>
    <script src="{{ url_for('analytics.static', filename='js/analytics_main.js') }}"></script>
</body>
</html>