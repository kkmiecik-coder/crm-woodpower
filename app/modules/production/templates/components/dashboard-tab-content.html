<!-- dashboard-tab-content.html - POPRAWIONY Z PRAWDZIWYMI DANYMI I ID -->
<!-- Quick Actions Bar -->
<div class="quick-actions-bar">
    <div class="quick-actions-list">
        <button id="manual-sync-btn" class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#baselinkerSyncModal"
                title="Rƒôczna synchronizacja z Baselinker">
            <i class="fas fa-sync-alt me-2"></i>
            Synchronizuj z Baselinker
        </button>
    </div>
</div>

<!-- Dashboard Grid -->
<div class="production-dashboard-grid">
    <!-- Statystyki Stanowisk -->
    <div class="widget stations-overview">
        <div class="widget-header">
            <h3>PrzeglƒÖd stanowisk</h3>
            <span class="last-updated" id="stations-updated">Aktualizacja...</span>
        </div>
        <div class="widget-content">
            <div class="stations-grid">
                <!-- CUTTING STATION - POPRAWIONE DANE -->
                <div class="station-card cutting-station"
                     data-station="cutting"
                     data-station-url="{{ url_for('production.production_stations.cutting_station') }}">
                    <div class="station-icon">ü™ö</div>
                    <div class="station-info">
                        <h4>Wycinanie</h4>
                        <div class="station-stats">
                            <div class="stat">
                                <span class="stat-value" id="cutting-pending">{{ dashboard_stats.stations.cutting.pending_count or 0 }}</span>
                                <span class="stat-label">OczekujƒÖce</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="cutting-today-m3">{{ "%.3f"|format(dashboard_stats.stations.cutting.today_m3 or 0) }}</span>
                                <span class="stat-label">m3 dzisiaj</span>
                            </div>
                        </div>
                    </div>
                    <div class="station-status" id="cutting-status">
                        <span class="status-dot {% if dashboard_stats.stations.cutting.pending_count > 15 %}danger{% elif dashboard_stats.stations.cutting.pending_count > 5 %}warning{% elif dashboard_stats.stations.cutting.pending_count > 0 %}active{% endif %}"></span>
                    </div>
                </div>

                <!-- ASSEMBLY STATION - POPRAWIONE DANE -->
                <div class="station-card assembly-station"
                     data-station="assembly"
                     data-station-url="{{ url_for('production.production_stations.assembly_station') }}">
                    <div class="station-icon">üîß</div>
                    <div class="station-info">
                        <h4>Sk≈Çadanie</h4>
                        <div class="station-stats">
                            <div class="stat">
                                <span class="stat-value" id="assembly-pending">{{ dashboard_stats.stations.assembly.pending_count or 0 }}</span>
                                <span class="stat-label">OczekujƒÖce</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="assembly-today-m3">{{ "%.3f"|format(dashboard_stats.stations.assembly.today_m3 or 0) }}</span>
                                <span class="stat-label">m3 dzisiaj</span>
                            </div>
                        </div>
                    </div>
                    <div class="station-status" id="assembly-status">
                        <span class="status-dot {% if dashboard_stats.stations.assembly.pending_count > 15 %}danger{% elif dashboard_stats.stations.assembly.pending_count > 5 %}warning{% elif dashboard_stats.stations.assembly.pending_count > 0 %}active{% endif %}"></span>
                    </div>
                </div>

                <!-- PACKAGING STATION - POPRAWIONE DANE -->
                <div class="station-card packaging-station"
                     data-station="packaging"
                     data-station-url="{{ url_for('production.production_stations.packaging_station') }}">
                    <div class="station-icon">üì¶</div>
                    <div class="station-info">
                        <h4>Pakowanie</h4>
                        <div class="station-stats">
                            <div class="stat">
                                <span class="stat-value" id="packaging-pending">{{ dashboard_stats.stations.packaging.pending_count or 0 }}</span>
                                <span class="stat-label">OczekujƒÖce</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="packaging-today-m3">{{ "%.3f"|format(dashboard_stats.stations.packaging.today_m3 or 0) }}</span>
                                <span class="stat-label">m3 dzisiaj</span>
                            </div>
                        </div>
                    </div>
                    <div class="station-status" id="packaging-status">
                        <span class="status-dot {% if dashboard_stats.stations.packaging.pending_count > 15 %}danger{% elif dashboard_stats.stations.packaging.pending_count > 5 %}warning{% elif dashboard_stats.stations.packaging.pending_count > 0 %}active{% endif %}"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dzisiejsze Podsumowanie - POPRAWIONE DANE Z WSZYSTKIMI ID -->
    <div class="widget today-summary">
        <div class="widget-header">
            <h3>Dzisiejsze podsumowanie</h3>
            <span class="date-info" id="today-date">{{ moment().strftime('%A, %d %B %Y') if moment else '' }}</span>
        </div>
        <div class="widget-content">
            <div class="summary-stats">
                <div class="summary-card completed-orders">
                    <div class="summary-icon">‚úÖ</div>
                    <div class="summary-data">
                        <span class="summary-value" id="today-completed">{{ dashboard_stats.today_totals.completed_orders or 0 }}</span>
                        <span class="summary-label">Uko≈Ñczone zam√≥wienia</span>
                    </div>
                </div>
                <div class="summary-card total-volume">
                    <div class="summary-icon">üìä</div>
                    <div class="summary-data">
                        <span class="summary-value" id="today-total-m3">{{ "%.3f"|format(dashboard_stats.today_totals.total_m3 or 0) }}</span>
                        <span class="summary-label">Ca≈Çkowity wolumen m¬≥</span>
                    </div>
                </div>
                <div class="summary-card avg-deadline">
                    <div class="summary-icon">‚è±Ô∏è</div>
                    <div class="summary-data">
                        <span class="summary-value" id="today-avg-deadline">{{ "%.0f"|format(dashboard_stats.today_totals.avg_deadline_distance or 0) }}</span>
                        <span class="summary-label">≈öredni deadline (dni)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerty Termin√≥w - POPRAWIONE DANE -->
    <div class="widget deadline-alerts">
        <div class="widget-header">
            <h3>Alerty Termin√≥w</h3>
            <span class="alert-count" id="alerts-count">{{ dashboard_stats.deadline_alerts|length }}</span>
        </div>
        <div class="widget-content">
            <div class="alerts-list" id="alerts-list">
                {% if dashboard_stats.deadline_alerts %}
                {% for alert in dashboard_stats.deadline_alerts %}
                <div class="alert-item {% if alert.days_remaining <= 0 %}alert-overdue{% elif alert.days_remaining <= 1 %}alert-critical{% elif alert.days_remaining <= 2 %}alert-warning{% else %}alert-normal{% endif %}">
                    <div class="alert-icon">
                        {% if alert.days_remaining <= 0 %}üö®
                        {% elif alert.days_remaining <= 1 %}‚ö†Ô∏è
                        {% elif alert.days_remaining <= 2 %}‚è≥
                        {% else %}‚è∞{% endif %}
                    </div>
                    <div class="alert-content">
                        <div class="alert-header">
                            <span class="alert-product-id">{{ alert.short_product_id }}</span>
                            <span class="alert-days">{{ alert.days_remaining }} dni</span>
                        </div>
                        <div class="alert-details">
                            <span class="alert-station">{{ alert.current_station }}</span>
                            {% if alert.deadline_date %}
                            <span class="alert-deadline">{{ alert.deadline_date }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="no-alerts-state" id="alerts-empty">
                    <div class="no-alerts-icon">‚úÖ</div>
                    <p class="no-alerts-text">Brak pilnych alert√≥w</p>
                    <small class="text-muted">Wszystkie produkty zgodne z terminem</small>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- System Health - POPRAWIONE Z STATUSAMI -->
    <div class="widget system-health">
        <div class="widget-header">
            <h3>Status systemu</h3>
            <span class="health-indicator" id="health-indicator">
                <span class="health-dot {% if dashboard_stats.system_health.sync_status == 'success' %}success{% else %}warning{% endif %}"></span>
            </span>
        </div>
        <div class="widget-content">
            <div class="health-items">
                <!-- Ostatnia synchronizacja -->
                <div class="health-item" id="sync-health">
                    <div class="health-left">
                        <div class="health-label">Ostatnia synch.</div>
                        <div class="health-value" id="last-sync-time">
                            {% if dashboard_stats.system_health.last_sync %}
                            {{ dashboard_stats.system_health.last_sync[:19] | replace('T', ' ') }}
                            {% else %}
                            Brak danych
                            {% endif %}
                        </div>
                    </div>
                    <div class="health-right">
                        <div class="health-status {% if dashboard_stats.system_health.sync_status == 'success' %}status-success{% else %}status-warning{% endif %}" id="sync-status">
                            {% if dashboard_stats.system_health.sync_status == 'success' %}
                            SUCCESS
                            {% elif dashboard_stats.system_health.sync_status == 'warning' %}
                            WARNING
                            {% else %}
                            ERROR
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Baza danych -->
                <div class="health-item" id="database-health">
                    <div class="health-left">
                        <div class="health-label">Baza danych</div>
                        <div class="health-value" id="db-response-time">{{ dashboard_stats.system_health.database_status or 'connected' }}</div>
                    </div>
                    <div class="health-right">
                        <div class="health-status {% if dashboard_stats.system_health.database_status == 'connected' %}status-success{% else %}status-error{% endif %}" id="db-status">
                            {% if dashboard_stats.system_health.database_status == 'connected' %}
                            OK
                            {% else %}
                            ERROR
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Base API -->
                <div class="health-item" id="api-health">
                    <div class="health-left">
                        <div class="health-label">Base. API</div>
                        <div class="health-value" id="api-response-time">OK</div>
                    </div>
                    <div class="health-right">
                        <div class="health-status status-success" id="api-status">OK</div>
                    </div>
                </div>

                <!-- B≈Çƒôdy systemu -->
                <div class="health-item" id="errors-health">
                    <div class="health-left">
                        <div class="health-label">B≈Çƒôdy systemu</div>
                        <div class="health-value">{{ dashboard_stats.system_health.errors_24h or 0 }}</div>
                    </div>
                    <div class="health-right">
                        <div class="health-status {% if (dashboard_stats.system_health.errors_24h or 0) == 0 %}status-success{% elif (dashboard_stats.system_health.errors_24h or 0) > 5 %}status-error{% else %}status-warning{% endif %}" id="errors-status">
                            {% set errors = dashboard_stats.system_health.errors_24h or 0 %}
                            {% if errors == 0 %}
                            OK
                            {% elif errors > 5 %}
                            HIGH
                            {% else %}
                            MEDIUM
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            {% if current_user.role in ['admin', 'administrator'] %}
            <div class="health-actions">
                <button class="health-action-btn error-details-btn" id="show-errors-btn" type="button">
                    üëÅÔ∏è Poka≈º b≈Çƒôdy
                </button>
                <button class="health-action-btn" id="clear-errors-btn" type="button">
                    üßπ Wyczy≈õƒá b≈Çƒôdy
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Wykres Wydajno≈õci (je≈õli admin) -->
    {% if current_user.role in ['admin', 'administrator'] %}
    <div class="col-lg-12">
        <div class="widget performance-chart">
            <div class="widget-header">
                <h5 class="widget-title">
                    <i class="fas fa-chart-line me-2"></i>
                    Wydajno≈õƒá dzienna
                </h5>
            </div>
            <div class="widget-content">
                <canvas id="performance-chart-canvas"></canvas>
                <div class="chart-loader" aria-hidden="true">
                    <div class="spinner"></div>
                    <span>≈Åadowanie danych wykresu...</span>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Modal b≈Çƒôd√≥w systemu -->
<div class="modal fade" id="systemErrorsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">B≈Çƒôdy systemu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
            </div>
            <div class="modal-body">
                <div class="errors-loading" id="errors-loading" style="display:none;">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">≈Åadowanie b≈Çƒôd√≥w...</p>
                    </div>
                </div>
                <div class="errors-empty" id="errors-empty" style="display:none;">
                    <div class="text-center text-muted">
                        <i class="fas fa-check-circle fa-3x mb-3 text-success"></i>
                        <h5>Brak b≈Çƒôd√≥w!</h5>
                        <p>System dzia≈Ça bez b≈Çƒôd√≥w.</p>
                    </div>
                </div>
                <div class="errors-list" id="errors-list">
                    <!-- B≈Çƒôdy zostanƒÖ za≈Çadowane dynamicznie -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
                <button type="button" class="btn btn-danger" id="clear-all-errors-btn">
                    üßπ Wyczy≈õƒá wszystkie b≈Çƒôdy
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Include modal synchronizacji z Baselinker -->
{% include 'components/dashboard_bl_sync_modal.html' %}