<!-- dashboard-tab-content.html -->
<!-- Komponent zawarto≈õci taba Dashboard - bez DOCTYPE, head, body, sidebar -->

<!-- Quick Actions Bar (bez link√≥w do innych tab√≥w) -->
<div class="quick-actions-bar">
    <div class="quick-actions-list">
        <button id="manual-sync-btn" class="quick-action-btn" onclick="triggerManualSync()">
            <span class="quick-action-icon">üîÑ</span>
            Synchronizuj
        </button>
    </div>
</div>

<!-- Dashboard Grid -->
<div class="production-dashboard-grid">
    <!-- Statystyki Stanowisk -->
    <div class="widget stations-overview">
        <div class="widget-header">
            <h3>PrzeglƒÖd stanowisk</h3>
            <span class="last-updated" id="stations-updated">Aktualizacja...</span>
        </div>
        <div class="widget-content">
            <div class="stations-grid">
                <!-- POPRAWIONE: Dodano data-station-url dla poprawnego routingu -->
                <div class="station-card cutting-station" 
                     data-station="cutting"
                     data-station-url="{{ url_for('production.production_stations.cutting_station') }}">
                    <div class="station-icon">ü™ö</div>
                    <div class="station-info">
                        <h4>Wycinanie</h4>
                        <div class="station-stats">
                            <div class="stat">
                                <span class="stat-value" id="cutting-pending">-</span>
                                <span class="stat-label">OczekujƒÖce</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="cutting-today-m3">-</span>
                                <span class="stat-label">m3 dzisiaj</span>
                            </div>
                        </div>
                    </div>
                    <div class="station-status" id="cutting-status">
                        <span class="status-dot"></span>
                    </div>
                </div>

                <div class="station-card assembly-station" 
                     data-station="assembly"
                     data-station-url="{{ url_for('production.production_stations.assembly_station') }}">
                    <div class="station-icon">üîß</div>
                    <div class="station-info">
                        <h4>Sk≈Çadanie</h4>
                        <div class="station-stats">
                            <div class="stat">
                                <span class="stat-value" id="assembly-pending">-</span>
                                <span class="stat-label">OczekujƒÖce</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="assembly-today-m3">-</span>
                                <span class="stat-label">m3 dzisiaj</span>
                            </div>
                        </div>
                    </div>
                    <div class="station-status" id="assembly-status">
                        <span class="status-dot"></span>
                    </div>
                </div>

                <div class="station-card packaging-station" 
                     data-station="packaging"
                     data-station-url="{{ url_for('production.production_stations.packaging_station') }}">
                    <div class="station-icon">üì¶</div>
                    <div class="station-info">
                        <h4>Pakowanie</h4>
                        <div class="station-stats">
                            <div class="stat">
                                <span class="stat-value" id="packaging-pending">-</span>
                                <span class="stat-label">OczekujƒÖce</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value" id="packaging-today-m3">-</span>
                                <span class="stat-label">m3 dzisiaj</span>
                            </div>
                        </div>
                    </div>
                    <div class="station-status" id="packaging-status">
                        <span class="status-dot"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dzisiejsze Podsumowanie -->
    <div class="widget today-summary">
        <div class="widget-header">
            <h3>Dzisiejsze podsumowanie</h3>
            <span class="date-info" id="today-date"></span>
        </div>
        <div class="widget-content">
            <div class="summary-stats">
                <div class="summary-card completed-orders">
                    <div class="summary-icon">‚úÖ</div>
                    <div class="summary-data">
                        <span class="summary-value" id="today-completed">-</span>
                        <span class="summary-label">Uko≈Ñczone zam√≥wienia</span>
                    </div>
                </div>
                <div class="summary-card total-volume">
                    <div class="summary-icon">üìä</div>
                    <div class="summary-data">
                        <span class="summary-value" id="today-total-m3">-</span>
                        <span class="summary-label">Ca≈Çkowity wolumen m¬≥</span>
                    </div>
                </div>
                <div class="summary-card avg-deadline">
                    <div class="summary-icon">‚è±Ô∏è</div>
                    <div class="summary-data">
                        <span class="summary-value" id="today-avg-deadline">-</span>
                        <span class="summary-label">≈öredni deadline (dni)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alerty Termin√≥w -->
    <div class="widget deadline-alerts">
        <div class="widget-header">
            <h3>Alerty Termin√≥w</h3>
            <span class="alert-count" id="alerts-count">-</span>
        </div>
        <div class="widget-content">
            <div class="alerts-list" id="alerts-list">
                <div class="loading-state">≈Åadowanie alert√≥w...</div>
            </div>
        </div>
    </div>

    <!-- System Health -->
    <div class="widget system-health">
        <div class="widget-header">
            <h3>Status systemu</h3>
            <span class="health-indicator" id="health-indicator">
                <span class="health-dot"></span>
            </span>
        </div>
        <div class="widget-content">
            <div class="health-items">
                <div class="health-item" id="sync-health">
                    <div class="health-label">Ostatnia synchronizacja</div>
                    <div class="health-value" id="last-sync-time">-</div>
                    <div class="health-status" id="sync-status"></div>
                </div>
                <div class="health-item" id="database-health">
                    <div class="health-label">Baza danych</div>
                    <div class="health-value" id="db-response-time">-</div>
                    <div class="health-status" id="db-status"></div>
                </div>
                <div class="health-item" id="api-health">
                    <div class="health-label">Baselinker API</div>
                    <div class="health-value" id="api-response-time">-</div>
                    <div class="health-status" id="api-status"></div>
                </div>
                <div class="health-item" id="errors-health">
                    <div class="health-label">B≈Çƒôdy systemu</div>
                    <div class="health-value" id="error-count">-</div>
                    <div class="health-status" id="errors-status"></div>
                </div>
            </div>

            {% if current_user.role in ['admin', 'administrator'] %}
            <div class="health-actions">
                <button class="health-action-btn error-details-btn" onclick="showSystemErrorsModal()">
                    üëÅÔ∏è Poka≈º b≈Çƒôdy
                </button>
                <button class="health-action-btn" onclick="clearSystemErrors()">
                    üßπ Wyczy≈õƒá b≈Çƒôdy
                </button>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Wykres Wydajno≈õci (je≈õli admin) -->
    {% if current_user.role in ['admin', 'administrator'] %}
    <div class="widget performance-chart">
        <div class="widget-header">
            <h3>Wydajno≈õƒá dzienna</h3>
            <div class="chart-controls">
                <select id="chart-period" onchange="updateChart()">
                    <option value="7">Ostatnie 7 dni</option>
                    <option value="14">Ostatnie 14 dni</option>
                    <option value="30">Ostatnie 30 dni</option>
                </select>
            </div>
        </div>
        <div class="widget-content">
            <canvas id="performance-chart-canvas" width="400" height="200"></canvas>
        </div>
    </div>
    {% endif %}
</div>

<!-- Modal b≈Çƒôd√≥w systemu (przeniesiony do komponentu) -->
<div class="modal fade" id="systemErrorsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">B≈Çƒôdy systemu</h5>
                <button type="button" class="btn-close" onclick="closeSystemErrorsModal()"></button>
            </div>
            <div class="modal-body">
                <div class="errors-loading" id="errors-loading" style="display:none;">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">≈Åadowanie b≈Çƒôd√≥w...</p>
                    </div>
                </div>
                <div class="errors-empty" id="errors-empty" style="display:none;">
                    <div class="text-center text-muted">
                        <i class="fas fa-check-circle fa-3x mb-3 text-success"></i>
                        <h5>Brak b≈Çƒôd√≥w!</h5>
                        <p>System dzia≈Ça bez b≈Çƒôd√≥w.</p>
                    </div>
                </div>
                <div class="errors-list" id="errors-list">
                    <!-- B≈Çƒôdy zostanƒÖ za≈Çadowane dynamicznie -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeSystemErrorsModal()">Zamknij</button>
                <button type="button" class="btn btn-danger" onclick="clearAllSystemErrors()">
                    üßπ Wyczy≈õƒá wszystkie b≈Çƒôdy
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // JavaScript specyficzny dla dashboard taba
    
    // Przekazanie danych z backendu do JavaScript (tylko dla tego taba)
    window.dashboardTabStats = {{ dashboard_stats|tojson if dashboard_stats else {}|tojson }};
    window.dashboardEndpoints = {
        dashboardStats: '{{ url_for("production.production_api.dashboard_stats") }}',
        manualSync: '{{ url_for("production.production_api.manual_sync") }}',
        healthCheck: '{{ url_for("production.production_api.health_check") }}',
        updatePriority: '/production/api/update-priority'
    };

    // Inicjalizacja dashboard po za≈Çadowaniu komponentu
    function initDashboardTab() {
        console.log('[Dashboard Tab] Inicjalizacja komponentu dashboard');
        
        // Za≈Çaduj dane poczƒÖtkowe
        if (window.dashboardTabStats && Object.keys(window.dashboardTabStats).length > 0) {
            console.log('[Dashboard Tab] U≈ºywam danych z serwera');
            updateDashboardData(window.dashboardTabStats);
        }
        
        // Inicjalizuj obs≈Çugƒô klikniƒôƒá w karty stanowisk
        initStationCards();
        
        // Inicjalizuj wykresy je≈õli admin
        if (window.productionConfig && window.productionConfig.currentUser.role === 'admin') {
            initializeCharts();
        }
        
        console.log('[Dashboard Tab] Komponent zainicjalizowany');
    }
    
    // Obs≈Çuga klikniƒôƒá w karty stanowisk
    function initStationCards() {
        document.querySelectorAll('.station-card').forEach(card => {
            card.addEventListener('click', function() {
                const stationUrl = this.getAttribute('data-station-url');
                if (stationUrl) {
                    window.location.href = stationUrl;
                }
            });
        });
    }
    
    // Aktualizacja danych dashboard
    function updateDashboardData(data) {
        console.log('[Dashboard Tab] Aktualizacja danych:', data);
        
        // Tutaj bƒôdzie logika aktualizacji widget√≥w
        // Na razie placeholder
        if (data.stations) {
            updateStationsStats(data.stations);
        }
        if (data.today_totals) {
            updateTodayTotals(data.today_totals);
        }
        if (data.deadline_alerts) {
            updateDeadlineAlerts(data.deadline_alerts);
        }
        if (data.system_health) {
            updateSystemHealth(data.system_health);
        }
    }
    
    // Placeholder functions - bƒôdƒÖ zaimplementowane
    function updateStationsStats(stations) {
        console.log('TODO: Update stations stats', stations);
    }
    
    function updateTodayTotals(totals) {
        console.log('TODO: Update today totals', totals);
    }
    
    function updateDeadlineAlerts(alerts) {
        console.log('TODO: Update deadline alerts', alerts);
    }
    
    function updateSystemHealth(health) {
        console.log('TODO: Update system health', health);
    }
    
    function initializeCharts() {
        console.log('TODO: Initialize charts for admin');
    }
    
    // Funkcje modali i akcji
    function showSystemErrorsModal() {
        console.log('TODO: Show system errors modal');
        // Otw√≥rz modal
        const modal = document.getElementById('systemErrorsModal');
        if (modal) {
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
        }
    }
    
    function closeSystemErrorsModal() {
        const modal = document.getElementById('systemErrorsModal');
        if (modal) {
            const bootstrapModal = bootstrap.Modal.getInstance(modal);
            if (bootstrapModal) {
                bootstrapModal.hide();
            }
        }
    }
    
    function clearSystemErrors() {
        console.log('TODO: Clear system errors');
    }
    
    function clearAllSystemErrors() {
        console.log('TODO: Clear all system errors');
    }
    
    function triggerManualSync() {
        console.log('TODO: Trigger manual sync');
    }
    
    function updateChart() {
        console.log('TODO: Update performance chart');
    }
    
    // Auto-inicjalizacja je≈õli komponent jest za≈Çadowany bezpo≈õrednio
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initDashboardTab);
    } else {
        initDashboardTab();
    }
</script>