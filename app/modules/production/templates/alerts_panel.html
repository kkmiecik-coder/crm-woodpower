<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Alert√≥w - Wood Power CRM</title>
    
    <!-- Style globalne -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Style modu≈Çu production -->
    <link rel="stylesheet" href="{{ url_for('production.static', filename='css/production.css') }}">
    
    <!-- Font Awesome dla ikon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        {% include 'sidebar/sidebar.html' %}
        
        <!-- G≈Ç√≥wna zawarto≈õƒá -->
        <div class="main-content">
            <!-- Header -->
            <div class="production-header">
                <div class="header-content">
                    <div class="header-left">
                        <h1 class="page-title">
                            <i class="fas fa-bell"></i>
                            Panel Alert√≥w Produkcji
                        </h1>
                        <p class="page-subtitle">Powiadomienia o op√≥≈∫nieniach, wƒÖskich gard≈Çach i problemach</p>
                    </div>
                    <div class="header-right">
                        <button class="btn btn-primary" onclick="markAllAsRead()">
                            <i class="fas fa-check-double"></i>
                            Oznacz wszystkie jako przeczytane
                        </button>
                        <button class="btn btn-outline" onclick="refreshAlerts()">
                            <i class="fas fa-sync"></i>
                            Od≈õwie≈º
                        </button>
                        <a href="{{ url_for('production.production_dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i>
                            Powr√≥t
                        </a>
                    </div>
                </div>
            </div>

            <!-- Podsumowanie alert√≥w -->
            <div class="alerts-summary">
                <div class="summary-card critical">
                    <div class="summary-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="summary-content">
                        <h3 id="criticalCount">3</h3>
                        <p>Krytyczne</p>
                    </div>
                </div>
                
                <div class="summary-card warning">
                    <div class="summary-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="summary-content">
                        <h3 id="warningCount">7</h3>
                        <p>Ostrze≈ºenia</p>
                    </div>
                </div>
                
                <div class="summary-card info">
                    <div class="summary-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="summary-content">
                        <h3 id="infoCount">5</h3>
                        <p>Informacyjne</p>
                    </div>
                </div>
                
                <div class="summary-card success">
                    <div class="summary-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="summary-content">
                        <h3 id="resolvedCount">12</h3>
                        <p>RozwiƒÖzane dzi≈õ</p>
                    </div>
                </div>
            </div>

            <!-- Filtry alert√≥w -->
            <div class="alerts-filters">
                <div class="filters-content">
                    <div class="filter-group">
                        <label for="alertTypeFilter">Typ alertu:</label>
                        <select id="alertTypeFilter" class="form-select" onchange="applyFilters()">
                            <option value="">Wszystkie typy</option>
                            <option value="delay">Op√≥≈∫nienia</option>
                            <option value="bottleneck">WƒÖskie gard≈Ça</option>
                            <option value="error">B≈Çƒôdy systemu</option>
                            <option value="completion">Uko≈Ñczenia</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="statusFilter">Status:</label>
                        <select id="statusFilter" class="form-select" onchange="applyFilters()">
                            <option value="">Wszystkie</option>
                            <option value="unread">Nieprzeczytane</option>
                            <option value="read">Przeczytane</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="priorityFilter">Priorytet:</label>
                        <select id="priorityFilter" class="form-select" onchange="applyFilters()">
                            <option value="">Wszystkie</option>
                            <option value="critical">Krytyczne</option>
                            <option value="warning">Ostrze≈ºenia</option>
                            <option value="info">Informacyjne</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="dateFilter">Data:</label>
                        <select id="dateFilter" class="form-select" onchange="applyFilters()">
                            <option value="today">Dzisiaj</option>
                            <option value="yesterday">Wczoraj</option>
                            <option value="week">Ostatnie 7 dni</option>
                            <option value="month">Ostatnie 30 dni</option>
                            <option value="all">Wszystkie</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-outline" onclick="clearFilters()">
                        <i class="fas fa-times"></i>
                        Wyczy≈õƒá filtry
                    </button>
                </div>
            </div>

            <!-- Lista alert√≥w -->
            <div class="alerts-section">
                <div class="section-header">
                    <h2>
                        <i class="fas fa-list"></i>
                        Lista alert√≥w (<span id="alertsCount">15</span>)
                    </h2>
                    <div class="sort-options">
                        <label for="sortBy">Sortuj wed≈Çug:</label>
                        <select id="sortBy" class="form-select" onchange="sortAlerts()">
                            <option value="created_desc">Najnowsze pierwsze</option>
                            <option value="created_asc">Najstarsze pierwsze</option>
                            <option value="priority_desc">Priorytet (wysokie ‚Üí niskie)</option>
                            <option value="priority_asc">Priorytet (niskie ‚Üí wysokie)</option>
                            <option value="type">Typ alertu</option>
                        </select>
                    </div>
                </div>

                <div class="alerts-list" id="alertsList">
                    <!-- Alert krytyczny - op√≥≈∫nienie -->
                    <div class="alert-item alert-critical" data-alert-id="1" data-type="delay" data-priority="critical" data-status="unread" data-date="2025-07-10">
                        <div class="alert-indicator">
                            <div class="alert-dot critical"></div>
                        </div>
                        
                        <div class="alert-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        
                        <div class="alert-content">
                            <div class="alert-header">
                                <h3>üî¥ KRYTYCZNE: Zadanie #1247 - 2 dni po terminie</h3>
                                <div class="alert-meta">
                                    <span class="alert-time">10.07.2025 09:15</span>
                                    <span class="alert-type-badge delay">Op√≥≈∫nienie</span>
                                </div>
                            </div>
                            <div class="alert-message">
                                Zadanie produkcyjne wymaga natychmiastowej interwencji:<br>
                                <strong>Produkt:</strong> Blat drewniany dƒôbowy mikrowczep 180x70x3 cm<br>
                                <strong>Termin:</strong> 08.07.2025<br>
                                <strong>Aktualny etap:</strong> Lakierowanie<br>
                                <strong>Status:</strong> 2 DNI PO TERMINIE
                            </div>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-primary" onclick="viewTaskDetails(1247)">
                                    <i class="fas fa-eye"></i>
                                    Zobacz zadanie
                                </button>
                                <button class="btn btn-small btn-outline" onclick="markAsRead(1)">
                                    <i class="fas fa-check"></i>
                                    Oznacz jako przeczytane
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert-close">
                            <button class="btn-close" onclick="dismissAlert(1)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Alert ostrze≈ºenia - wƒÖskie gard≈Ço -->
                    <div class="alert-item alert-warning" data-alert-id="2" data-type="bottleneck" data-priority="warning" data-status="unread" data-date="2025-07-10">
                        <div class="alert-indicator">
                            <div class="alert-dot warning"></div>
                        </div>
                        
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        
                        <div class="alert-content">
                            <div class="alert-header">
                                <h3>üöß WƒÑSKIE GARD≈ÅO: Stanowisko Lakierowania</h3>
                                <div class="alert-meta">
                                    <span class="alert-time">10.07.2025 08:30</span>
                                    <span class="alert-type-badge bottleneck">WƒÖskie gard≈Ço</span>
                                </div>
                            </div>
                            <div class="alert-message">
                                Wykryto wƒÖskie gard≈Ço w produkcji:<br>
                                <strong>Stanowisko:</strong> Lakierowanie<br>
                                <strong>Zadania oczekujƒÖce:</strong> 8<br>
                                <strong>Zadania w trakcie:</strong> 2<br>
                                <strong>Rekomendacja:</strong> Sprawd≈∫ czy stanowisko potrzebuje wsparcia
                            </div>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-primary" onclick="viewWorkstationDetails('lakierowanie')">
                                    <i class="fas fa-industry"></i>
                                    Zobacz stanowisko
                                </button>
                                <button class="btn btn-small btn-outline" onclick="markAsRead(2)">
                                    <i class="fas fa-check"></i>
                                    Przeczytane
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert-close">
                            <button class="btn-close" onclick="dismissAlert(2)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Alert informacyjny - uko≈Ñczenie -->
                    <div class="alert-item alert-info" data-alert-id="3" data-type="completion" data-priority="info" data-status="read" data-date="2025-07-10">
                        <div class="alert-indicator">
                            <div class="alert-dot info"></div>
                        </div>
                        
                        <div class="alert-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        
                        <div class="alert-content">
                            <div class="alert-header">
                                <h3>‚úÖ Partia DƒÑB-MIK-003 uko≈Ñczona</h3>
                                <div class="alert-meta">
                                    <span class="alert-time">10.07.2025 07:45</span>
                                    <span class="alert-type-badge completion">Uko≈Ñczenie</span>
                                    <span class="alert-status-badge read">Przeczytane</span>
                                </div>
                            </div>
                            <div class="alert-message">
                                Partia produkcyjna zosta≈Ça pomy≈õlnie uko≈Ñczona:<br>
                                <strong>Partia:</strong> DƒÑB-MIK-003<br>
                                <strong>Zadania:</strong> 12/12 uko≈Ñczonych<br>
                                <strong>Czas realizacji:</strong> 3 dni, 2 godziny<br>
                                <strong>Wydajno≈õƒá:</strong> 98% (powy≈ºej planu)
                            </div>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-outline" onclick="viewBatchDetails(3)">
                                    <i class="fas fa-layer-group"></i>
                                    Zobacz partiƒô
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert-close">
                            <button class="btn-close" onclick="dismissAlert(3)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Alert b≈Çƒôdu systemu -->
                    <div class="alert-item alert-error" data-alert-id="4" data-type="error" data-priority="critical" data-status="unread" data-date="2025-07-10">
                        <div class="alert-indicator">
                            <div class="alert-dot critical pulsing"></div>
                        </div>
                        
                        <div class="alert-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        
                        <div class="alert-content">
                            <div class="alert-header">
                                <h3>üî¥ B≈ÅƒÑD: Problem synchronizacji z Baselinker</h3>
                                <div class="alert-meta">
                                    <span class="alert-time">10.07.2025 06:00</span>
                                    <span class="alert-type-badge error">B≈ÇƒÖd systemu</span>
                                </div>
                            </div>
                            <div class="alert-message">
                                WystƒÖpi≈Ç b≈ÇƒÖd podczas synchronizacji z Baselinker:<br>
                                <strong>B≈ÇƒÖd:</strong> Connection timeout after 30 seconds<br>
                                <strong>Ostatnia udana synchronizacja:</strong> 09.07.2025 23:45<br>
                                <strong>Wp≈Çyw:</strong> Nowe zam√≥wienia mogƒÖ nie byƒá widoczne<br>
                                <strong>Rekomendacja:</strong> Sprawd≈∫ po≈ÇƒÖczenie i spr√≥buj ponownie
                            </div>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-danger" onclick="retrySync()">
                                    <i class="fas fa-sync"></i>
                                    Spr√≥buj ponownie
                                </button>
                                <button class="btn btn-small btn-outline" onclick="viewErrorDetails(4)">
                                    <i class="fas fa-bug"></i>
                                    Szczeg√≥≈Çy b≈Çƒôdu
                                </button>
                                <button class="btn btn-small btn-outline" onclick="markAsRead(4)">
                                    <i class="fas fa-check"></i>
                                    Przeczytane
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert-close">
                            <button class="btn-close" onclick="dismissAlert(4)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Alert ostrze≈ºenia - termin zbli≈ºa siƒô -->
                    <div class="alert-item alert-warning" data-alert-id="5" data-type="delay" data-priority="warning" data-status="unread" data-date="2025-07-10">
                        <div class="alert-indicator">
                            <div class="alert-dot warning"></div>
                        </div>
                        
                        <div class="alert-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        
                        <div class="alert-content">
                            <div class="alert-header">
                                <h3>‚ö†Ô∏è OSTRZE≈ªENIE: Zadanie #1251 - 2 dni przed terminem</h3>
                                <div class="alert-meta">
                                    <span class="alert-time">10.07.2025 05:30</span>
                                    <span class="alert-type-badge delay">Ostrze≈ºenie terminu</span>
                                </div>
                            </div>
                            <div class="alert-message">
                                Zadanie zbli≈ºa siƒô do terminu realizacji:<br>
                                <strong>Produkt:</strong> Parapet dƒôbowy lity 120x25x3 cm<br>
                                <strong>Termin:</strong> 12.07.2025<br>
                                <strong>Aktualny etap:</strong> Sklejanie<br>
                                <strong>Postƒôp:</strong> 40% (pozosta≈Ço 3 etapy)
                            </div>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-primary" onclick="prioritizeTask(1251)">
                                    <i class="fas fa-arrow-up"></i>
                                    Zwiƒôksz priorytet
                                </button>
                                <button class="btn btn-small btn-outline" onclick="viewTaskDetails(1251)">
                                    <i class="fas fa-eye"></i>
                                    Zobacz zadanie
                                </button>
                                <button class="btn btn-small btn-outline" onclick="markAsRead(5)">
                                    <i class="fas fa-check"></i>
                                    Przeczytane
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert-close">
                            <button class="btn-close" onclick="dismissAlert(5)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Paginacja -->
                <div class="alerts-pagination">
                    <button class="btn btn-outline" onclick="loadPreviousPage()" id="prevBtn" disabled>
                        <i class="fas fa-chevron-left"></i>
                        Poprzednia
                    </button>
                    <span class="pagination-info">
                        Strona <span id="currentPage">1</span> z <span id="totalPages">3</span>
                    </span>
                    <button class="btn btn-outline" onclick="loadNextPage()" id="nextBtn">
                        Nastƒôpna
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal szczeg√≥≈Ç√≥w b≈Çƒôdu -->
    <div id="errorDetailsModal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Szczeg√≥≈Çy b≈Çƒôdu systemu</h3>
                <button class="modal-close" onclick="closeErrorDetails()">&times;</button>
            </div>
            <div class="modal-body" id="errorDetailsContent">
                <!-- Tre≈õƒá bƒôdzie ≈Çadowana dynamicznie -->
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>≈Åadowanie alert√≥w...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('production.static', filename='js/production_dashboard.js') }}"></script>
    
    <script>
        let currentPage = 1;
        let totalPages = 3;
        let currentFilters = {};

        document.addEventListener('DOMContentLoaded', function() {
            initializeAlertsPanel();
            updateAlertsCounts();
            
            // Auto-refresh co 30 sekund
            setInterval(() => {
                refreshAlerts();
            }, 30000);
        });

        function initializeAlertsPanel() {
            // Ustaw domy≈õlne filtry
            document.getElementById('dateFilter').value = 'today';
            document.getElementById('statusFilter').value = 'unread';
            
            applyFilters();
        }

        function applyFilters() {
            currentFilters = {
                type: document.getElementById('alertTypeFilter').value,
                status: document.getElementById('statusFilter').value,
                priority: document.getElementById('priorityFilter').value,
                date: document.getElementById('dateFilter').value
            };
            
            filterAlerts();
            updateAlertsCounts();
        }

        function filterAlerts() {
            const alerts = document.querySelectorAll('.alert-item');
            let visibleCount = 0;
            
            alerts.forEach(alert => {
                let show = true;
                
                // Filtr typu
                if (currentFilters.type && alert.dataset.type !== currentFilters.type) {
                    show = false;
                }
                
                // Filtr statusu
                if (currentFilters.status && alert.dataset.status !== currentFilters.status) {
                    show = false;
                }
                
                // Filtr priorytetu
                if (currentFilters.priority && alert.dataset.priority !== currentFilters.priority) {
                    show = false;
                }
                
                // Filtr daty
                if (currentFilters.date && currentFilters.date !== 'all') {
                    const alertDate = new Date(alert.dataset.date);
                    const today = new Date();
                    let showByDate = false;
                    
                    switch(currentFilters.date) {
                        case 'today':
                            showByDate = alertDate.toDateString() === today.toDateString();
                            break;
                        case 'yesterday':
                            const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);
                            showByDate = alertDate.toDateString() === yesterday.toDateString();
                            break;
                        case 'week':
                            const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                            showByDate = alertDate >= weekAgo;
                            break;
                        case 'month':
                            const monthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                            showByDate = alertDate >= monthAgo;
                            break;
                    }
                    
                    if (!showByDate) show = false;
                }
                
                alert.style.display = show ? 'flex' : 'none';
                if (show) visibleCount++;
            });
            
            document.getElementById('alertsCount').textContent = visibleCount;
        }

        function clearFilters() {
            document.getElementById('alertTypeFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('dateFilter').value = 'all';
            
            applyFilters();
        }

        function sortAlerts() {
            const sortBy = document.getElementById('sortBy').value;
            const alertsList = document.getElementById('alertsList');
            const alerts = Array.from(alertsList.children);
            
            alerts.sort((a, b) => {
                switch(sortBy) {
                    case 'created_desc':
                        return new Date(b.dataset.date) - new Date(a.dataset.date);
                    case 'created_asc':
                        return new Date(a.dataset.date) - new Date(b.dataset.date);
                    case 'priority_desc':
                        const priorityOrder = {'critical': 3, 'warning': 2, 'info': 1};
                        return priorityOrder[b.dataset.priority] - priorityOrder[a.dataset.priority];
                    case 'priority_asc':
                        const priorityOrderAsc = {'critical': 3, 'warning': 2, 'info': 1};
                        return priorityOrderAsc[a.dataset.priority] - priorityOrderAsc[b.dataset.priority];
                    case 'type':
                        return a.dataset.type.localeCompare(b.dataset.type);
                    default:
                        return 0;
                }
            });
            
            // Usu≈Ñ wszystkie alerty i dodaj je w nowej kolejno≈õci
            alerts.forEach(alert => alertsList.removeChild(alert));
            alerts.forEach(alert => alertsList.appendChild(alert));
        }

        function updateAlertsCounts() {
            const alerts = document.querySelectorAll('.alert-item[style*="flex"], .alert-item:not([style*="none"])');
            
            let criticalCount = 0;
            let warningCount = 0;
            let infoCount = 0;
            let resolvedCount = 0;
            
            alerts.forEach(alert => {
                const priority = alert.dataset.priority;
                const status = alert.dataset.status;
                
                if (status === 'read') {
                    resolvedCount++;
                } else {
                    switch(priority) {
                        case 'critical':
                            criticalCount++;
                            break;
                        case 'warning':
                            warningCount++;
                            break;
                        case 'info':
                            infoCount++;
                            break;
                    }
                }
            });
            
            document.getElementById('criticalCount').textContent = criticalCount;
            document.getElementById('warningCount').textContent = warningCount;
            document.getElementById('infoCount').textContent = infoCount;
            document.getElementById('resolvedCount').textContent = resolvedCount;
        }

        function markAsRead(alertId) {
            showLoading();
            
            fetch(`/production/api/alert/${alertId}/read`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
                    if (alertElement) {
                        alertElement.dataset.status = 'read';
                        alertElement.classList.remove('alert-critical', 'alert-warning', 'alert-error');
                        alertElement.classList.add('alert-read');
                        
                        // Dodaj badge "przeczytane"
                        const meta = alertElement.querySelector('.alert-meta');
                        if (!meta.querySelector('.alert-status-badge')) {
                            const badge = document.createElement('span');
                            badge.className = 'alert-status-badge read';
                            badge.textContent = 'Przeczytane';
                            meta.appendChild(badge);
                        }
                    }
                    
                    updateAlertsCounts();
                    showToast('Alert oznaczony jako przeczytany', 'success');
                } else {
                    showToast('B≈ÇƒÖd oznaczania alertu', 'error');
                }
            })
            .catch(error => {
                hideLoading();
                showToast('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
            });
        }

        function markAllAsRead() {
            if (confirm('Czy na pewno chcesz oznaczyƒá wszystkie alerty jako przeczytane?')) {
                showLoading();
                
                fetch('/production/api/alerts/mark-all-read', {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        // Oznacz wszystkie widoczne alerty jako przeczytane
                        document.querySelectorAll('.alert-item[data-status="unread"]').forEach(alert => {
                            alert.dataset.status = 'read';
                            alert.classList.remove('alert-critical', 'alert-warning', 'alert-error');
                            alert.classList.add('alert-read');
                            
                            const meta = alert.querySelector('.alert-meta');
                            if (!meta.querySelector('.alert-status-badge')) {
                                const badge = document.createElement('span');
                                badge.className = 'alert-status-badge read';
                                badge.textContent = 'Przeczytane';
                                meta.appendChild(badge);
                            }
                        });
                        
                        updateAlertsCounts();
                        showToast(`Oznaczono ${data.marked_count} alert√≥w jako przeczytane`, 'success');
                    } else {
                        showToast('B≈ÇƒÖd oznaczania alert√≥w', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
                });
            }
        }

        function dismissAlert(alertId) {
            if (confirm('Czy na pewno chcesz usunƒÖƒá ten alert?')) {
                const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
                if (alertElement) {
                    alertElement.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        alertElement.remove();
                        updateAlertsCounts();
                    }, 300);
                }
                
                // Wywo≈Çaj API do usuniƒôcia alertu
                fetch(`/production/api/alert/${alertId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Alert zosta≈Ç usuniƒôty', 'info');
                    }
                })
                .catch(error => {
                    console.error('B≈ÇƒÖd usuwania alertu:', error);
                });
            }
        }

        function refreshAlerts() {
            showLoading();
            
            fetch('/production/api/alerts?page=' + currentPage)
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        updateAlertsDisplay(data.alerts);
                        updatePagination(data.pagination);
                        updateAlertsCounts();
                        showToast('Alerty od≈õwie≈ºone', 'success');
                    } else {
                        showToast('B≈ÇƒÖd od≈õwie≈ºania alert√≥w', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
                });
        }

        function updateAlertsDisplay(alerts) {
            // TODO: Dynamiczna aktualizacja listy alert√≥w
            // Na razie przekieruj na reload strony
            console.log('Aktualizacja alert√≥w:', alerts);
        }

        function updatePagination(pagination) {
            currentPage = pagination.current_page;
            totalPages = pagination.total_pages;
            
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
            
            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
        }

        function loadPreviousPage() {
            if (currentPage > 1) {
                currentPage--;
                refreshAlerts();
            }
        }

        function loadNextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                refreshAlerts();
            }
        }

        function viewTaskDetails(taskId) {
            window.open(`/production/api/task/${taskId}/details`, '_blank');
        }

        function viewWorkstationDetails(workstationName) {
            window.location.href = `/production/dashboard?workstation=${workstationName}`;
        }

        function viewBatchDetails(batchId) {
            window.location.href = `/production/batches?batch=${batchId}`;
        }

        function prioritizeTask(taskId) {
            if (confirm('Czy na pewno chcesz zwiƒôkszyƒá priorytet tego zadania?')) {
                showLoading();
                
                fetch(`/production/api/task/${taskId}/priority`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'increase' })
                })
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        showToast('Priorytet zadania zosta≈Ç zwiƒôkszony', 'success');
                    } else {
                        showToast('B≈ÇƒÖd zmiany priorytetu', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
                });
            }
        }

        function retrySync() {
            showLoading();
            
            fetch('/production/api/sync/baselinker', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showToast('Synchronizacja z Baselinker zako≈Ñczona pomy≈õlnie', 'success');
                    
                    // Usu≈Ñ alert o b≈Çƒôdzie synchronizacji
                    const errorAlert = document.querySelector('[data-alert-id="4"]');
                    if (errorAlert) {
                        errorAlert.remove();
                        updateAlertsCounts();
                    }
                } else {
                    showToast(`B≈ÇƒÖd synchronizacji: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                hideLoading();
                showToast('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
            });
        }

        function viewErrorDetails(alertId) {
            showLoading();
            
            fetch(`/production/api/alert/${alertId}/details`)
                .then(response => response.json())
                .then(data => {
                    hideLoading();
                    if (data.success) {
                        displayErrorDetails(data.error_details);
                    } else {
                        showToast('B≈ÇƒÖd pobierania szczeg√≥≈Ç√≥w', 'error');
                    }
                })
                .catch(error => {
                    hideLoading();
                    showToast('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem', 'error');
                });
        }

        function displayErrorDetails(errorDetails) {
            const content = document.getElementById('errorDetailsContent');
            content.innerHTML = `
                <div class="error-details">
                    <div class="error-section">
                        <h4>Informacje o b≈Çƒôdzie</h4>
                        <div class="error-info">
                            <div class="info-row">
                                <label>Czas wystƒÖpienia:</label>
                                <span>${errorDetails.timestamp}</span>
                            </div>
                            <div class="info-row">
                                <label>Typ b≈Çƒôdu:</label>
                                <span>${errorDetails.error_type}</span>
                            </div>
                            <div class="info-row">
                                <label>Modu≈Ç:</label>
                                <span>${errorDetails.module}</span>
                            </div>
                            <div class="info-row">
                                <label>Kod b≈Çƒôdu:</label>
                                <span>${errorDetails.error_code}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="error-section">
                        <h4>Opis b≈Çƒôdu</h4>
                        <div class="error-message">
                            ${errorDetails.message}
                        </div>
                    </div>
                    
                    <div class="error-section">
                        <h4>Szczeg√≥≈Çy techniczne</h4>
                        <div class="error-stack">
                            <pre>${errorDetails.stack_trace || 'Brak dostƒôpnych szczeg√≥≈Ç√≥w'}</pre>
                        </div>
                    </div>
                    
                    <div class="error-section">
                        <h4>Sugerowane dzia≈Çania</h4>
                        <ul class="error-actions-list">
                            ${errorDetails.suggested_actions.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('errorDetailsModal').style.display = 'flex';
        }

        function closeErrorDetails() {
            document.getElementById('errorDetailsModal').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showToast(message, type = 'info') {
            // TODO: Implementacja toast notifications
            console.log(`Toast [${type}]: ${message}`);
        }

        // CSS Animations (dodaj do pliku CSS)
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from {
                    opacity: 1;
                    transform: translateX(0);
                }
                to {
                    opacity: 0;
                    transform: translateX(100%);
                }
            }
            
            .alert-dot.pulsing {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
                }
                70% {
                    box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
                }
                100% {
                    box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>