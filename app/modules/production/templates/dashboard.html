<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modu≈Ç Produkcyjny - Wood Power CRM</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('production.static', filename='css/production.css') }}">
</head>
<body>
    <div class="app-container">
        <!-- Include sidebar -->
        {% include 'sidebar/sidebar.html' %}

        <div class="main-content">
            <div class="prod-module-header">
                <h1 class="prod-module-title">
                    <span class="prod-module-icon">üè≠</span>
                    Modu≈Ç Produkcyjny
                </h1>
                <div class="prod-module-sync-actions">
                    <button class="prod-module-btn prod-module-btn-secondary" id="refreshButton">
                        <span class="prod-module-refresh-icon">üîÑ</span>
                        Od≈õwie≈º
                        <span class="prod-module-timer" id="refreshTimer">(30s)</span>
                    </button>
                    <button class="prod-module-btn prod-module-btn-primary" id="syncOrdersBtn">
                        üì• Synchronizuj zam√≥wienia
                    </button>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="prod-module-tabs">
                <button class="prod-module-tab active" data-tab="dashboard">
                    üìä Dashboard
                </button>
                <button class="prod-module-tab" data-tab="production-list">
                    üìã Lista produkcyjna
                </button>
                <button class="prod-module-tab" data-tab="settings">
                    ‚öôÔ∏è Ustawienia
                </button>
                <button class="prod-module-tab" data-tab="reports">
                    üìà Raporty
                </button>
            </div>

            <!-- Tab Contents -->
            <div class="prod-module-content">
                
                <!-- TAB 1: DASHBOARD -->
                <div class="prod-module-tab-content active" id="dashboard">
                    
                    <!-- Statystyki g≈Ç√≥wne -->
                    <div class="prod-module-stats-grid">
                        <div class="prod-module-stat-card prod-module-stat-pending">
                            <div class="prod-module-stat-icon">‚è≥</div>
                            <div class="prod-module-stat-info">
                                <div class="prod-module-stat-number" id="pendingItems">-</div>
                                <div class="prod-module-stat-label">OczekujƒÖce</div>
                            </div>
                        </div>
                        
                        <div class="prod-module-stat-card prod-module-stat-progress">
                            <div class="prod-module-stat-icon">üîß</div>
                            <div class="prod-module-stat-info">
                                <div class="prod-module-stat-number" id="inProgressItems">-</div>
                                <div class="prod-module-stat-label">W trakcie</div>
                            </div>
                        </div>
                        
                        <div class="prod-module-stat-card prod-module-stat-completed">
                            <div class="prod-module-stat-icon">‚úÖ</div>
                            <div class="prod-module-stat-info">
                                <div class="prod-module-stat-number" id="completedItems">-</div>
                                <div class="prod-module-stat-label">Uko≈Ñczone</div>
                            </div>
                        </div>
                        
                        <div class="prod-module-stat-card prod-module-stat-overdue">
                            <div class="prod-module-stat-icon">üö®</div>
                            <div class="prod-module-stat-info">
                                <div class="prod-module-stat-number" id="overdueItems">-</div>
                                <div class="prod-module-stat-label">Op√≥≈∫nione</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sekcja stanowisk i kolejki -->
                    <div class="prod-module-dashboard-grid">
                        
                        <!-- Stanowiska produkcyjne -->
                        <div class="prod-module-section">
                            <h2 class="prod-module-section-title">
                                üè≠ Stanowiska produkcyjne
                            </h2>
                            <div class="prod-module-stations-grid" id="stationsGrid">
                                <!-- Stanowiska bƒôdƒÖ dodawane dynamicznie -->
                                <div class="prod-module-station-placeholder">
                                    ≈Åadowanie stanowisk...
                                </div>
                            </div>
                        </div>

                        <!-- Zam√≥wienia do produkcji -->
                        <div class="prod-module-section">
                            <h2 class="prod-module-section-title">
                                üìã Zam√≥wienia do produkcji (TOP 10)
                                <button class="prod-module-btn-icon" id="refreshQueueBtn" title="Od≈õwie≈º zam√≥wienia">
                                    üîÑ
                                </button>
                            </h2>
                            <div class="prod-module-queue-container" id="queueContainer">
                                <!-- Zam√≥wienia bƒôdƒÖ dodawane dynamicznie -->
                                <div class="prod-module-queue-placeholder">
                                    ≈Åadowanie zam√≥wie≈Ñ...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 2: LISTA PRODUKCYJNA -->
                <div class="prod-module-tab-content" id="production-list">
                    
                    <!-- Filtry -->
                    <div class="prod-module-filters">
                        <div class="prod-module-filter-group">
                            <label for="statusFilter">Status:</label>
                            <select id="statusFilter" class="prod-module-select">
                                <option value="">Wszystkie</option>
                                <option value="pending">OczekujƒÖce</option>
                                <option value="in_progress">W trakcie</option>
                                <option value="completed">Uko≈Ñczone</option>
                                <option value="on_hold">Wstrzymane</option>
                            </select>
                        </div>
                        
                        <div class="prod-module-filter-group">
                            <label for="speciesFilter">Gatunek:</label>
                            <select id="speciesFilter" class="prod-module-select">
                                <option value="">Wszystkie</option>
                                <option value="dƒÖb">DƒÖb</option>
                                <option value="buk">Buk</option>
                                <option value="jesion">Jesion</option>
                                <option value="sosna">Sosna</option>
                                <option value="brzoza">Brzoza</option>
                            </select>
                        </div>
                        
                        <div class="prod-module-filter-group">
                            <label for="technologyFilter">Technologia:</label>
                            <select id="technologyFilter" class="prod-module-select">
                                <option value="">Wszystkie</option>
                                <option value="lita">Lita</option>
                                <option value="mikrowczep">Mikrowczep</option>
                            </select>
                        </div>
                        
                        <div class="prod-module-filter-group filter-actions">
                            <button class="prod-module-btn prod-module-btn-secondary" id="applyFiltersBtn">
                                üîç Zastosuj filtry
                            </button>
                            <button class="prod-module-btn prod-module-btn-outline prod-module-hidden" id="clearFiltersBtn">
                                üóëÔ∏è Wyczy≈õƒá
                            </button>
                        </div>
                    </div>

                    <!-- Tabela produkt√≥w -->
                    <div class="prod-module-table-container">
                        <table class="prod-module-table" id="productionTable">
                            <thead>
                                <tr>
                                    <th style="width: 30px;">‚â°</th>
                                    <th style="width: 80px;">Pozycja</th>
                                    <th>Produkt</th>
                                    <th>Gatunek</th>
                                    <th>Technologia</th>
                                    <th>Klasa</th>
                                    <th>Wyko≈Ñczenie</th>
                                    <th>Wymiary</th>
                                    <th>Ilo≈õƒá</th>
                                    <th>Deadline</th>
                                    <th>Status</th>
                                    <th style="width: 50px;">Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="productionTableBody">
                                <tr>
                                    <td colspan="12" class="prod-module-table-loading">
                                        ≈Åadowanie danych...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- TAB 3: USTAWIENIA -->
                <div class="prod-module-tab-content" id="settings">
                    
                    <!-- Sekcje ustawie≈Ñ -->
                    <div class="prod-module-settings-grid">
                        
                        <!-- Konfiguracja czas√≥w -->
                        <div class="prod-module-settings-section">
                            <h3 class="prod-module-settings-title">‚è±Ô∏è Ustawienia czas√≥w</h3>
                            <div class="prod-module-settings-form">
                                <div class="prod-module-form-group">
                                    <label for="gluingTime">Czas sklejania (minuty):</label>
                                    <input type="number" id="gluingTime" class="prod-module-input" value="20" min="1" max="120">
                                </div>
                                <div class="prod-module-form-group">
                                    <label for="maxOvertime">Maksymalny overtime (minuty):</label>
                                    <input type="number" id="maxOvertime" class="prod-module-input" value="60" min="1" max="180">
                                </div>
                                <button class="prod-module-btn prod-module-btn-primary" id="saveTimeSettingsBtn">
                                    üíæ Zapisz ustawienia czas√≥w
                                </button>
                            </div>
                        </div>

                        <!-- ZarzƒÖdzanie pracownikami -->
                        <div class="prod-module-settings-section">
                            <h3 class="prod-module-settings-title">
                                üë∑‚Äç‚ôÇÔ∏è Pracownicy
                                <button class="prod-module-btn-icon" id="addWorkerBtn" title="Dodaj pracownika">
                                    ‚ûï
                                </button>
                            </h3>
                            <div class="prod-module-workers-list" id="workersList">
                                <!-- Lista pracownik√≥w bƒôdzie dodawana dynamicznie -->
                                <div class="prod-module-list-placeholder">
                                    ≈Åadowanie pracownik√≥w...
                                </div>
                            </div>
                        </div>

                        <!-- Narzƒôdzia administracyjne -->
                        <div class="prod-module-settings-section">
                            <h3 class="prod-module-settings-title">üîß Narzƒôdzia</h3>
                            <div class="prod-module-tools-grid">
                                <button class="prod-module-btn prod-module-btn-warning" id="recalculatePrioritiesBtn">
                                    üîÑ Przelicz priorytety
                                </button>
                                <button class="prod-module-btn prod-module-btn-info" id="reparseProductsBtn">
                                    üîç Ponownie parsuj produkty
                                </button>
                                <button class="prod-module-btn prod-module-btn-danger" id="testBaselinkerBtn">
                                    üîó Test Baselinker API
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 4: RAPORTY -->
                <div class="prod-module-tab-content" id="reports">
                    
                    <!-- Filtry raport√≥w -->
                    <div class="prod-module-reports-filters">
                        <div class="prod-module-filter-group">
                            <label for="reportDateFrom">Data od:</label>
                            <input type="date" id="reportDateFrom" class="prod-module-input">
                        </div>
                        <div class="prod-module-filter-group">
                            <label for="reportDateTo">Data do:</label>
                            <input type="date" id="reportDateTo" class="prod-module-input">
                        </div>
                        <div class="prod-module-filter-group">
                            <button class="prod-module-btn prod-module-btn-primary" id="generateReportsBtn">
                                üìä Generuj raporty
                            </button>
                        </div>
                    </div>

                    <!-- Sekcje raport√≥w -->
                    <div class="prod-module-reports-grid">
                        
                        <!-- Wydajno≈õƒá pracownik√≥w -->
                        <div class="prod-module-report-section">
                            <h3 class="prod-module-section-title">üë∑‚Äç‚ôÇÔ∏è Wydajno≈õƒá pracownik√≥w</h3>
                            <div class="prod-module-report-content" id="workersReport">
                                <div class="prod-module-report-placeholder">
                                    Wybierz zakres dat i kliknij "Generuj raporty"
                                </div>
                            </div>
                        </div>

                        <!-- Wydajno≈õƒá stanowisk -->
                        <div class="prod-module-report-section">
                            <h3 class="prod-module-section-title">üè≠ Wydajno≈õƒá stanowisk</h3>
                            <div class="prod-module-report-content" id="stationsReport">
                                <div class="prod-module-report-placeholder">
                                    Wybierz zakres dat i kliknij "Generuj raporty"
                                </div>
                            </div>
                        </div>

                        <!-- Analiza op√≥≈∫nie≈Ñ -->
                        <div class="prod-module-report-section">
                            <h3 class="prod-module-section-title">üö® Analiza op√≥≈∫nie≈Ñ</h3>
                            <div class="prod-module-report-content" id="delaysReport">
                                <div class="prod-module-report-placeholder">
                                    Wybierz zakres dat i kliknij "Generuj raporty"
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Dodatkowe funkcje pomocnicze -->
    <script>
        // Dodaj funkcjƒô addModalStyles() dla modali
        function addModalStyles() {
            if (document.getElementById('prod-module-modal-styles')) {
                return; // Style ju≈º dodane
            }
            
            const styles = document.createElement('style');
            styles.id = 'prod-module-modal-styles';
            styles.textContent = `
                .prod-module-modal * {
                    box-sizing: border-box;
                }
            `;
            document.head.appendChild(styles);
        }
        
        // GLOBALNE funkcje dostƒôpne z HTML (zachowaj istniejƒÖce)
        window.showChangePositionModal = function(itemId, currentPosition) {
            if (typeof showChangePositionModal === 'function') {
                showChangePositionModal(itemId, currentPosition);
            } else {
                console.error('[Production] Funkcja showChangePositionModal nie jest dostƒôpna');
            }
        };
        
        window.showPriorityExplanation = function(itemId) {
            if (typeof showPriorityExplanation === 'function') {
                showPriorityExplanation(itemId);
            } else {
                console.error('[Production] Funkcja showPriorityExplanation nie jest dostƒôpna');
            }
        };
        
        // Aktualizuj globalnƒÖ funkcjƒô editPriority ≈ºeby u≈ºywa≈Ça nowego systemu
        window.editPriority = function(itemId) {
            // U≈ºyj nowego modala zmiany pozycji
            const currentRow = document.querySelector(`tr[data-item-id="${itemId}"]`);
            if (currentRow) {
                const currentPosition = parseInt(currentRow.getAttribute('data-priority-score'));
                window.showChangePositionModal(itemId, currentPosition);
            } else {
                console.error('[Production] Nie znaleziono wiersza dla produktu:', itemId);
            }
        };
    </script>

    <!-- Script imports (zachowaj istniejƒÖce) -->
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
    <script src="{{ url_for('production.static', filename='js/production.js') }}"></script>
</body>
</html>